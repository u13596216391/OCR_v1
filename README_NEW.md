# OCR-RAG æ–‡æ¡£å¤„ç†æµæ°´çº¿

è¯¥ç³»ç»Ÿé€šè¿‡ Docker Compose è¿›è¡Œå®¹å™¨åŒ–ç¼–æ’ï¼Œé›†æˆäº†åç«¯ APIã€å¼‚æ­¥ä»»åŠ¡å¤„ç†ã€å‰ç«¯ç•Œé¢ä»¥åŠç¬¬ä¸‰æ–¹æ ‡æ³¨å·¥å…· Label Studioã€‚

## âœ¨ æœ€æ–°æ”¹è¿› (2025-10)

### ğŸš€ æ ¸å¿ƒä¼˜åŒ–

1. **Docker æ„å»ºä¼˜åŒ–**ï¼šåˆ©ç”¨å±‚ç¼“å­˜æœºåˆ¶ï¼Œé¢„ä¸‹è½½ MinerU æ¨¡å‹ï¼Œå¤§å¹…åŠ å¿«åç»­æ„å»ºé€Ÿåº¦
2. **è‡ªåŠ¨å¯¼å…¥ Label Studio**ï¼šæ”¯æŒæ‰¹é‡è‡ªåŠ¨å¯¼å…¥ OCR ç»“æœï¼Œæ— éœ€æ‰‹åŠ¨ä¸‹è½½ä¸Šä¼ 
3. **Nginx åå‘ä»£ç†**ï¼šç»Ÿä¸€å…¥å£ç®¡ç†æ‰€æœ‰æœåŠ¡ï¼Œæ— éœ€åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  IP åœ°å€
4. **GPU åŠ é€Ÿæ”¯æŒ**ï¼šæ”¯æŒ NVIDIA GPU åŠ é€Ÿ OCR è¯†åˆ«ï¼Œæå‡å¤„ç†é€Ÿåº¦

## æ ¸å¿ƒç‰¹æ€§

* **PDF ä¸Šä¼ **: é€šè¿‡ Web ç•Œé¢ä¸Šä¼  PDF æ–‡æ¡£è¿›è¡Œå¤„ç†ã€‚
* **è‡ªåŠ¨åŒ– OCR**: ä½¿ç”¨ `mineru` å·¥å…·ä½œä¸ºæ ¸å¿ƒ OCR å¼•æ“ï¼Œåœ¨åå°å¼‚æ­¥å¤„ç† PDFã€‚
* **GPU åŠ é€Ÿ**: æ”¯æŒ NVIDIA GPU åŠ é€Ÿï¼Œæ˜¾è‘—æå‡è¯†åˆ«é€Ÿåº¦ã€‚
* **æ•°æ®æŒä¹…åŒ–**: æ‰€æœ‰æ–‡æ¡£ä¿¡æ¯ã€çŠ¶æ€å’Œå¤„ç†ç»“æœéƒ½å­˜å‚¨åœ¨ PostgreSQL æ•°æ®åº“ä¸­ã€‚
* **æ™ºèƒ½æ ‡æ³¨é›†æˆ**:
    * è‡ªåŠ¨æ‰¹é‡å¯¼å…¥ OCR ç»“æœåˆ° `Label Studio`ã€‚
    * æ”¯æŒæ‰‹åŠ¨ä¸‹è½½å’Œä¸Šä¼  JSON æ–‡ä»¶ï¼ˆå‘åå…¼å®¹ï¼‰ã€‚
    * æ”¯æŒä¸Šä¼ ç”± `Label Studio` æ ¡å¯¹å’Œä¿®æ­£åçš„ JSON æ•°æ®ã€‚
* **RAG æ ¼å¼å¯¼å‡º**: å°†æ ¡å¯¹åçš„æ•°æ®ä¸€é”®è½¬æ¢ä¸º RAGFlow ç­‰ RAG ç³»ç»Ÿå…¼å®¹çš„ JSON æ ¼å¼ã€‚
* **åå‘ä»£ç†æ¶æ„**: é€šè¿‡ Nginx ç»Ÿä¸€ç®¡ç†ï¼Œå•ä¸€å…¥å£è®¿é—®æ‰€æœ‰æœåŠ¡ã€‚
* **å®Œæ•´çš„å®¹å™¨åŒ–ç¯å¢ƒ**: æ‰€æœ‰æœåŠ¡ï¼ˆæ•°æ®åº“ã€ç¼“å­˜ã€åç«¯ã€å‰ç«¯ç­‰ï¼‰éƒ½é€šè¿‡ Docker ç»Ÿä¸€ç®¡ç†ï¼Œå®ç°ä¸€é”®å¯åŠ¨ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Docker å’Œ Docker Compose
- ï¼ˆå¯é€‰ï¼‰NVIDIA Docker Runtimeï¼ˆå¦‚éœ€ GPU åŠ é€Ÿï¼‰

### ä¸€é”®å¯åŠ¨

```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½® LABEL_STUDIO_API_TOKEN ç­‰

# 2. å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d --build
```

å°±è¿™ä¹ˆç®€å•ï¼æ‰€æœ‰æœåŠ¡éƒ½ä¼šè‡ªåŠ¨å¯åŠ¨ã€‚

### å¯ç”¨ GPU åŠ é€Ÿï¼ˆå¯é€‰ï¼‰

å¦‚æœæ‚¨æœ‰ NVIDIA GPUï¼š

1. éªŒè¯ GPUï¼š
```bash
docker run --rm --gpus all nvidia/cuda:11.8.0-base-ubuntu22.04 nvidia-smi
```

2. ç¼–è¾‘ `docker-compose.yml`ï¼Œåœ¨ celery æœåŠ¡ä¸­å–æ¶ˆ GPU deploy éƒ¨åˆ†çš„æ³¨é‡Š

3. é‡å¯æœåŠ¡ï¼š
```bash
docker-compose up -d --build
```

## ğŸ“ è®¿é—®åœ°å€

æ‰€æœ‰æœåŠ¡é€šè¿‡ç»Ÿä¸€çš„ Nginx å…¥å£è®¿é—®ï¼š

- **å‰ç«¯åº”ç”¨**: `http://localhost/` æˆ– `http://your-server-ip/`
- **åç«¯ API**: `http://localhost/api/` æˆ– `http://your-server-ip/api/`
- **Label Studio**: `http://localhost/label-studio/` æˆ– `http://your-server-ip/label-studio/`
- **å¥åº·æ£€æŸ¥**: `http://localhost/health`

> ğŸ’¡ é¦–æ¬¡å¯åŠ¨ä¼šä¸‹è½½æ¨¡å‹æ–‡ä»¶ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´ã€‚

## ğŸ“ ä½¿ç”¨å·¥ä½œæµ

### æ¨èæ–¹å¼ï¼šè‡ªåŠ¨å¯¼å…¥

1. **ä¸Šä¼  PDF**: è®¿é—®å‰ç«¯ç•Œé¢ï¼Œä¸Šä¼ ä¸€ä¸ªæˆ–å¤šä¸ª PDF æ–‡æ¡£
2. **ç­‰å¾…å¤„ç†**: æ–‡æ¡£çŠ¶æ€å˜ä¸º `processed`
3. **è‡ªåŠ¨å¯¼å…¥**: è°ƒç”¨ API æ‰¹é‡å¯¼å…¥åˆ° Label Studio
   ```bash
   curl -X POST http://localhost/api/documents/auto-import-to-label-studio/ \
     -H "Content-Type: application/json" \
     -d '{"doc_ids": [1, 2, 3], "project_id": "1"}'
   ```
4. **æ ¡å¯¹æ ‡æ³¨**: åœ¨ Label Studio ä¸­æ ¡å¯¹ OCR ç»“æœ
5. **å¯¼å‡ºå¹¶ä¸Šä¼ **: å¯¼å‡ºæ ¡å¯¹ç»“æœå¹¶ä¸Šä¼ åˆ°ç³»ç»Ÿ
6. **ç”Ÿæˆ RAG æ–‡ä»¶**: ä¸‹è½½ RAGFlow æ ¼å¼æ–‡ä»¶

### ä¼ ç»Ÿæ–¹å¼ï¼šæ‰‹åŠ¨å¯¼å…¥ï¼ˆå‘åå…¼å®¹ï¼‰

1. ä¸Šä¼  PDF
2. ä¸‹è½½åŸå§‹ OCR JSON
3. æ‰‹åŠ¨å¯¼å…¥ Label Studio
4. åç»­æ­¥éª¤åŒä¸Š

## âš™ï¸ é…ç½®è¯´æ˜

### Label Studio é…ç½®

1. è®¿é—® `http://localhost/label-studio/`
2. åˆ›å»ºè´¦å·å¹¶ç™»å½•
3. ç”Ÿæˆ API Tokenï¼ˆAccount & Settings â†’ Access Tokenï¼‰
4. æ›´æ–° `.env` æ–‡ä»¶ï¼š
   ```bash
   LABEL_STUDIO_API_TOKEN=your_token_here
   LABEL_STUDIO_PROJECT_ID=1
   ```
5. é‡å¯æœåŠ¡ï¼š`docker-compose restart backend celery`

### GPU é…ç½®

1. å®‰è£… [NVIDIA Docker Runtime](https://github.com/NVIDIA/nvidia-docker)
2. éªŒè¯å®‰è£…ï¼š
   ```bash
   docker run --rm --gpus all nvidia/cuda:11.8.0-base-ubuntu22.04 nvidia-smi
   ```
3. ç¼–è¾‘ `docker-compose.yml`ï¼Œåœ¨ celery æœåŠ¡ä¸­å–æ¶ˆ deploy éƒ¨åˆ†çš„æ³¨é‡Š
4. é‡å¯æœåŠ¡ï¼š`docker-compose up -d --build`

## ğŸ“š è¯¦ç»†æ–‡æ¡£

å®Œæ•´çš„éƒ¨ç½²å’Œé…ç½®æŒ‡å—è¯·å‚é˜…ï¼š[DEPLOYMENT.md](DEPLOYMENT.md)

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢æœåŠ¡
docker-compose down

# é‡æ–°æ„å»º
docker-compose up -d --build
```

## ğŸ—ï¸ æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Nginx     â”‚  â† ç»Ÿä¸€å…¥å£ (ç«¯å£ 80)
â”‚  (åå‘ä»£ç†)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
   â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚   â”‚                       â”‚
   â–¼   â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontendâ”‚  â”‚ Backend  â”‚  â”‚ Label Studio â”‚
â”‚  (Vue)  â”‚  â”‚ (Django) â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€
         â”‚        â”‚        â”‚
         â–¼        â–¼        â–¼
     â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”
     â”‚ DB  â”‚  â”‚Redis â”‚  â”‚Celeryâ”‚
     â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- [è¯¦ç»†éƒ¨ç½²æ–‡æ¡£](DEPLOYMENT.md)
- é¡¹ç›®æ—¥å¿—ï¼š`docker-compose logs`
- GitHub Issues
